# RAG Audit Logs

The system now logs detailed RAG pipeline execution data to `backend/data/logs/rag_audit_log.jsonl`.

## Log Format
Each line in the file is a JSON object representing a single RAG event.

### Fields
- **timestamp**: ISO 8601 timestamp of the event.
- **event_type**: `RAG_TRACE` for question answering events.
- **data**:
  - **query**: The user's question.
  - **metrics**:
    - `initial_retrieval_count`: Number of chunks found by vector search (before filtering).
    - `filtered_count`: Number of chunks remaining after file/folder filtering.
    - `generation_time_ms`: Time taken for the full answer generation in milliseconds.
  - **reranking**: List of chunks after reranking, with their scores.
    - `text_snippet`: First 100 chars of the chunk.
    - `rerank_score`: Relevance score from the CrossEncoder (higher is better).
  - **selected_context_chunks**: The actual chunks passed to the LLM.
  - **full_context_length**: Total characters of context sent to the LLM.
  - **llm_response**: The final answer generated by the model.
  - **models**: Information about the models used (Embedding, Reranker, LLM).

## Usage
You can monitor this file using `tail -f` or parsed with any JSON log viewer to debug:
1. **Retrieval Issues**: Check `initial_retrieval_count`. If 0, embeddings might be missing.
2. **Ranking Issues**: Check `rerank_score`. If relevant chunks have low scores, the reranker might need adjustment.
3. **Context Issues**: Check `full_context_length` and `selected_context_chunks`. If the answer is hallucinated, check if the data was actually in the `text_snippet`.
